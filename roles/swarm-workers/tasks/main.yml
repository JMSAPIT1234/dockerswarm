- name: Check if Swarm was created
  shell: "docker info | grep 'Swarm: active' | wc -l"
  register: swarm_status

- name: Join Swarm Cluster
  shell: "docker swarm join --token={{ hostvars['manager']['worker_token']['stdout'] }} {{ hostvars['manager']['ansible_eth0']['ipv4']['address'] }}:2377"
  when: swarm_status.stdout!="1"
  retries: 3
  delay: 20
